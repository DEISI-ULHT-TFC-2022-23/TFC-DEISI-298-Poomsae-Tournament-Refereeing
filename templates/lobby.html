{% extends 'base_without_headers.html' %}
{% block title %}PTR - DashBoard{% endblock %}

{% block content%}
<header class="juri-header">
    <img src="/static/images/logo.png" alt="" srcset="" class="middle-top-logo">
</header>

<h1>Welcome, Judge </h1>
<h2>Tournaments Assigned:</h2>
<ul>
    {% for tournament in current_judge.tournaments %}
    {% for athlete in tournament.list_of_athletes %}
    <li>
        <a href="{{ url_for('evaluation', tournament_id=tournament.id, athlete_id=athlete.id) }}"
           data-tournament-id="{{ tournament.id }}" data-athlete-id="{{ athlete.id }}">
            {{ athlete.name }} - {{ tournament.name }}
        </a>
    </li>
    {% endfor %}
    {% endfor %}
</ul>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    const socket = io.connect();
    const current_judge = { name: 'Judge 1' }; // Replace this with the actual judge's data from the server-side

    document.querySelectorAll('a').forEach(a => {
        a.addEventListener('click', (e) => {
            e.preventDefault();
            const tournamentId = e.target.getAttribute('data-tournament-id');
            const athleteId = e.target.getAttribute('data-athlete-id');

            // Check if the judge is assigned to the selected tournament
            // You can handle this check on the server-side as well for more security
            if (current_judge.tournaments.includes(tournamentId)) {
                // If the judge is assigned, join the tournament's evaluation
                socket.emit('join_evaluation', { tournament_id: tournamentId, athlete_id: athleteId });
                window.location.href = e.target.href;
            } else {
                // If the judge is not assigned, display an error message or redirect
                alert('You are not assigned to this tournament.');
            }
        });
    });

    socket.on('no_more_athletes', () => {
        // Handle the case when there are no more athletes to evaluate
        // For example, display a message or redirect to the lobby page
        window.location.href = '/lobby'; // Redirect to the lobby page
    });
</script>
{% endblock%}